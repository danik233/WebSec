<!DOCTYPE HTML>
<html>

<head>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/loading.css">
    <link href="https://fonts.googleapis.com/css2?family=Krona+One&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>My Uploads - IsraTube</title>
    <style>
        .uploads-main {
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .uploads-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .uploads-header h1 {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .uploads-header p {
            font-size: 1.2em;
            opacity: 0.7;
        }

        .filter-section {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 12px 30px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .filter-btn:hover {
            background: #F5C518;
            border-color: #F5C518;
            color: white;
        }

        .filter-btn.active {
            background: #F5C518;
            border-color: #F5C518;
            color: white;
        }

        .uploads-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .upload-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            cursor: pointer;
        }

        .upload-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .upload-preview {
            width: 100%;
            height: 200px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            position: relative;
        }

        .upload-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-info {
            padding: 20px;
        }

        .upload-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .upload-meta {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .upload-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .download-btn {
            background: #4ECDC4;
            color: white;
        }

        .download-btn:hover {
            background: #44A08D;
        }

        .delete-btn {
            background: #FF6B6B;
            color: white;
        }

        .delete-btn:hover {
            background: #EE5A6F;
        }

        .no-uploads {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-uploads h2 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .no-uploads p {
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .upload-link-btn {
            display: inline-block;
            padding: 15px 40px;
            background: #F5C518;
            color: #000;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .upload-link-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(245, 197, 24, 0.4);
        }

        .loader-container {
            text-align: center;
            padding: 60px 20px;
        }

        .loader-container .loader {
            display: inline-block;
        }

        /* Dark mode */
        body.dark-mode .uploads-header h1,
        body.dark-mode .uploads-header p {
            color: white;
        }

        body.dark-mode .filter-btn {
            background: #2a2a2a;
            border-color: #555;
            color: white;
        }

        body.dark-mode .upload-card {
            background: #2a2a2a;
        }

        body.dark-mode .upload-title {
            color: white;
        }

        body.dark-mode .upload-meta {
            color: #ccc;
        }

        body.dark-mode .upload-preview {
            background: #1a1a1a;
        }

        body.dark-mode .no-uploads {
            color: #ccc;
        }
    </style>
</head>

<body>
    <header>
        <section id="loading-screen">
            <section class="loader"></section>
            <p>Loading, please wait...</p>
        </section>

        <section class="buttonANDlogo">
            <input id="burgerBtn" type="button" value="‚ò∞" alt="menu"
                style="width: 45px; height: 45px; font-size: 35px; background-color: transparent; border: none;">
            <a href="homepage.html">
                <p id="israTubeText">IsraTube</p>
            </a>
        </section>

        <section class="searchSystem">
            <input id="searchText" type="text" placeholder="Search">
            <input id="keyboardIcon" type="image" src="images/KeyBoard.png" alt="keyBoard" width="30" height="30">
            <input id="searchIcon" type="image" src="images/Search.png" alt="search" width="20" height="20">
        </section>

        <section class="loginSystem">
            <input id="moonDark" type="image" src="images/moonWhiteIcon.png" alt="darkmode" width="45" height="45">
            <section id="profileArea">
                <input id="profileIcon" type="image" src="images/profileIcon.png" alt="profile">
                <a href="index.html" id="logoutLink">Logout</a>
            </section>
        </section>
    </header>

    <aside id="sidebar" class="open">
        <ul>
            <li>
                <a href="homepage.html">
                    <img src="images/HomeIcon.png" alt="homeIcon">
                    <p>Home</p>
                </a>
            </li>
            <li>
                <a href="TvOnline.html">
                    <img src="images/TVOnline 1.png" alt="tvIcon">
                    <p>TV Online</p>
                </a>
            </li>
            <li>
                <a href="Movies.html">
                    <img src="images/MovieIcon.png" alt="movieIcon">
                    <p>Movies</p>
                </a>
            </li>
            <li>
                <a href="Songs.html">
                    <img src="images/Music-Music-icon 1.png" alt="musicIcon">
                    <p>Songs</p>
                </a>
            </li>
            <li>
                <a href="upload.html">
                    <img src="images/MovieIcon.png" alt="uploadIcon">
                    <p>Upload</p>
                </a>
            </li>
            <li class="activePage">
                <a href="myuploads.html">
                    <img src="images/MovieIcon.png" alt="myuploadsIcon">
                    <p>My Uploads</p>
                </a>
            </li>
            <li>
                <a href="About.html">
                    <img src="images/AboutUs.jpg" alt="aboutIcon">
                    <p>About</p>
                </a>
            </li>
        </ul>
    </aside>

    <main>
        <section class="mainWrap uploads-main">
            <div class="uploads-header">
                <h1>üìÅ My Uploads</h1>
                <p>View and manage your uploaded content</p>
            </div>

            <div class="filter-section">
                <button class="filter-btn active" onclick="filterUploads('all')">All</button>
                <button class="filter-btn" onclick="filterUploads('movie')">Movies</button>
                <button class="filter-btn" onclick="filterUploads('song')">Songs</button>
                <button class="filter-btn" onclick="filterUploads('tv')">TV Shows</button>
            </div>

            <div id="uploadsContainer" class="uploads-grid">
                <div class="loader-container">
                    <div class="loader"></div>
                    <p>Loading uploads...</p>
                </div>
            </div>
        </section>
    </main>

    <script src="js/home.js"></script>
    <script src="js/loading.js"></script>
    <script>
        let allUploads = [];
        let currentFilter = 'all';

        // Get CSRF token
        function getCSRFToken() {
            const match = document.cookie.match(/XSRF-TOKEN=([^;]+)/);
            return match ? match[1] : null;
        }

        // Format bytes
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Get file icon
        function getFileIcon(mimeType) {
            if (mimeType.startsWith('image/')) return 'üñºÔ∏è';
            if (mimeType.startsWith('video/')) return 'üé¨';
            if (mimeType.startsWith('audio/')) return 'üéµ';
            if (mimeType === 'application/pdf') return 'üìÑ';
            return 'üìÅ';
        }

        // Load uploads
        async function loadUploads() {
            try {
                const response = await fetch('/api/upload/files');
                const data = await response.json();

                if (data.success) {
                    allUploads = data.files;
                    displayUploads();
                } else {
                    showNoUploads();
                }
            } catch (error) {
                console.error('Error loading uploads:', error);
                showError('Failed to load uploads');
            }
        }

        // Display uploads
        function displayUploads() {
            const container = document.getElementById('uploadsContainer');

            // Filter uploads
            let filteredUploads = allUploads;
            if (currentFilter !== 'all') {
                filteredUploads = allUploads.filter(u =>
                    u.originalName.toLowerCase().includes(currentFilter)
                );
            }

            if (filteredUploads.length === 0) {
                showNoUploads();
                return;
            }

            container.innerHTML = filteredUploads.map(upload => `
                <div class="upload-card">
                    <div class="upload-preview">
                        ${upload.mimeType.startsWith('image/')
                    ? `<img src="/api/upload/download/${upload.id}" alt="${upload.originalName}" onerror="this.style.display='none'; this.parentElement.innerHTML='${getFileIcon(upload.mimeType)}';">`
                    : `<div>${getFileIcon(upload.mimeType)}</div>`
                }
                    </div>
                    <div class="upload-info">
                        <div class="upload-title">${upload.originalName}</div>
                        <div class="upload-meta">üì¶ Size: ${formatBytes(upload.size)}</div>
                        <div class="upload-meta">üìÖ ${new Date(upload.uploadedAt).toLocaleDateString()}</div>
                        <div class="upload-meta">‚¨áÔ∏è Downloads: ${upload.downloadCount}</div>
                        <div class="upload-actions">
                            <button class="action-btn download-btn" onclick="downloadFile('${upload.id}', '${upload.originalName}')">
                                Download
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteFile('${upload.id}')">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Show no uploads message
        function showNoUploads() {
            const container = document.getElementById('uploadsContainer');
            container.innerHTML = `
                <div class="no-uploads" style="grid-column: 1 / -1;">
                    <h2>üì≠ No Uploads Yet</h2>
                    <p>Start uploading your content to see it here!</p>
                    <a href="upload.html" class="upload-link-btn">Upload Now</a>
                </div>
            `;
        }

        // Show error
        function showError(message) {
            const container = document.getElementById('uploadsContainer');
            container.innerHTML = `
                <div class="no-uploads" style="grid-column: 1 / -1;">
                    <h2>‚ùå Error</h2>
                    <p>${message}</p>
                </div>
            `;
        }

        // Filter uploads
        function filterUploads(category) {
            currentFilter = category;

            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            displayUploads();
        }

        // Download file
        function downloadFile(fileId, fileName) {
            window.location.href = `/api/upload/download/${fileId}`;
        }

        // Delete file
        async function deleteFile(fileId) {
            if (!confirm('Are you sure you want to delete this file?')) {
                return;
            }

            try {
                const response = await fetch(`/api/upload/${fileId}`, {
                    method: 'DELETE',
                    headers: {
                        'X-XSRF-TOKEN': getCSRFToken()
                    }
                });

                const data = await response.json();

                if (data.success) {
                    alert('‚úÖ File deleted successfully!');
                    loadUploads(); // Reload the list
                } else {
                    alert('‚ùå Failed to delete file: ' + data.error);
                }
            } catch (error) {
                console.error('Delete error:', error);
                alert('‚ùå Failed to delete file');
            }
        }

        // Load uploads on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadUploads();
        });
    </script>
</body>

</html>